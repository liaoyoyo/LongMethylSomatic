---

## **程式目的**
本程式的目的是檢測 Somatic 突變位點附近的甲基化狀態，並分析突變 reads 與非突變 reads 在鄰近 CpG 位點的甲基化比例是否一致。通過此分析，可以判斷 Somatic 突變與甲基化模式之間是否存在關聯性，為研究基因組變異與表觀遺傳學提供依據。

---

## **輸入**
程式需要以下輸入檔案：

1. **Normal BAM 檔案** (`-n`)  
   - 來自正常組織的 BAM 檔案，包含 reads 的比對資訊及甲基化標籤。
2. **Tumor BAM 檔案** (`-t`)  
   - 來自腫瘤組織的 BAM 檔案，同樣包含 reads 的比對資訊及甲基化標籤。
3. **Somatic VCF 檔案** (`-v`)  
   - 由工具（如 ClairS）生成的 Somatic 突變 VCF 檔案，包含突變位點的染色體、位置、參考等位基因和突變等位基因等資訊。
4. **參考基因組檔案** (`-r`)  
   - FASTA 格式的參考基因組檔案（如 hg38），用於比對和位置參考。
5. **輸出檔案路徑** (`-o`)  
   - 指定分析結果的輸出檔案路徑。

---

## **輸出**
程式會生成一個文本檔案，包含以下分析結果：

- **Somatic 突變位點**  
  - 格式示例：`chr1:1000 (A>G)`，表示突變所在的染色體、位置及等位基因變化。
- **鄰近 CpG 位點**  
  - 格式示例：`chr1:950`，表示突變位點附近用於分析甲基化的 CpG 位點。
- **突變 reads 的甲基化比例**  
  - 格式示例：`90% 甲基化 (18/20)`，表示突變 reads 中甲基化的比例及具體數據（甲基化 reads 數/總 reads 數）。
- **非突變 reads 的甲基化比例**  
  - 格式示例：`10% 甲基化 (2/20)`，表示非突變 reads 的甲基化比例及具體數據。
- **結論**  
  - 格式示例：`存在一致性高甲基化差異` 或 `無顯著一致性差異`，根據甲基化比例差異判斷突變與甲基化模式的一致性。

---

## **流程**
程式的執行流程分為以下幾個主要步驟：

1. **解析命令行參數**  
   - 程式啟動時，從命令行讀取輸入檔案路徑（Normal BAM、Tumor BAM、VCF、參考基因組、輸出檔案）。
   - 若缺少必要參數或格式錯誤，顯示使用說明並終止程式。

2. **載入 Somatic VCF 檔案**  
   - 讀取 VCF 檔案，提取每個 Somatic 突變位點的資訊（如染色體、位置、參考和突變等位基因）。
   - 將突變位點儲存為內部數據結構，供後續處理。

3. **開啟 BAM 檔案**  
   - 分別載入 Normal BAM 和 Tumor BAM 檔案，包括其標頭和索引，以便快速查詢特定區域的 reads。

4. **分析突變位點**  
   - 對每個 Somatic 突變位點進行以下處理：
     - **提取 reads**：從 Tumor BAM 中提取突變位點附近（例如 ±50 bp 範圍）的 reads。
     - **分類 reads**：根據 reads 在突變位點的碱基，將其分為突變 reads（與 VCF 中的突變等位基因匹配）和非突變 reads。
     - **計算甲基化比例**：針對突變 reads 和非突變 reads，分別統計其在鄰近 CpG 位點的甲基化狀態。
     - **判斷一致性**：比較突變 reads 和非突變 reads 的甲基化比例，根據差異大小得出結論。

5. **輸出結果**  
   - 將所有突變位點的分析結果整理為規範的文本格式。
   - 將結果寫入指定的輸出檔案。

---

## **總結**
本程式整合 Somatic VCF 和 BAM 檔案的資訊，分析突變位點附近 CpG 位點的甲基化狀態，並判斷突變 reads 與非突變 reads 的甲基化模式是否一致。程式流程清晰且高效，適合處理大規模基因組數據，並為研究突變與表觀遺傳學的關聯性提供支持。